/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.object.ui.square=function(){this.target=null,this.timestamp=null,this.focus=!0,this.is_dragging=!1,this.is_drawing_finished=!1,this.selected_node=null,this.sx=null,this.sy=null,this.ex=null,this.ey=null,this.previous_x=null,this.previous_y=null,this.id=null,this.name=null,this.kind=null,this.x=null,this.y=null,this.width=null,this.height=null,this.connector=null,this.status=null,this.proportion=null,this.attribute_list=new Array("id","name","kind","timestamp","sx","sy","ex","ey")},org.goorm.core.object.ui.square.prototype={init:function(e,t,n){var r=this;return this.target=e,this.timestamp=(new Date).getTime(),this.connector=[],this.connector.tl=null,this.connector.t=null,this.connector.tr=null,this.connector.r=null,this.connector.br=null,this.connector.b=null,this.connector.bl=null,this.connector.l=null,this.proportion=n,this.id="square_"+this.timestamp,this.name="square_"+this.timestamp,this.kind=t,this.x=0,this.y=0,this.width=0,this.height=0,$(e).find("canvas").mousedown(function(e){if(!r.focus)return!1;var t=$(this).parent().offset();x=e.pageX-t.left,y=e.pageY-t.top,r.sx&&(r.sx=parseInt(r.sx)),r.sy&&(r.sy=parseInt(r.sy)),r.ex&&(r.ex=parseInt(r.ex)),r.ey&&(r.ey=parseInt(r.ey)),(r.sx-5<x&&x<r.ex+5||r.ex-5<x&&x<r.sx+5)&&(r.sy-5<y&&y<r.ey+5||r.ey-5<y&&y<r.sy+5)&&e.which==1&&(r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="body",x=e.pageX-t.left,y=e.pageY-t.top,r.previous_x=x,r.previous_y=y),e.which==1&&(!r.is_drawing_finished&&!r.is_dragging?(r.is_dragging=!0,r.is_drawing_finished=!1,x=e.pageX-t.left,y=e.pageY-t.top,r.sx=x,r.sy=y,r.selected_node=null):(x=e.pageX-t.left,y=e.pageY-t.top,r.sy-3<y&&y<r.sy+3&&r.sx-3<x&&x<r.sx+3?(r.change_status("status_resize_top_left"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="tl"):r.sy-3<y&&y<r.sy+3&&r.ex-3<x&&x<r.ex+3?(r.change_status("status_resize_top_right"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="tr"):r.ey-3<y&&y<r.ey+3&&r.ex-3<x&&x<r.ex+3?(r.change_status("status_resize_bottom_right"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="br"):r.ey-3<y&&y<r.ey+3&&r.sx-3<x&&x<r.sx+3?(r.change_status("status_resize_bottom_left"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="bl"):(r.sy+r.ey)/2-3<y&&y<(r.sy+r.ey)/2+3&&r.sx-3<x&&x<r.sx+3?(r.change_status("status_resize_left"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="l"):(r.sy+r.ey)/2-3<y&&y<(r.sy+r.ey)/2+3&&r.ex-3<x&&x<r.ex+3?(r.change_status("status_resize_right"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="r"):r.sy-3<y&&y<r.sy+3&&(r.sx+r.ex)/2-3<x&&x<(r.sx+r.ex)/2+3?(r.change_status("status_resize_top"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="t"):r.ey-3<y&&y<r.ey+3&&(r.sx+r.ex)/2-3<x&&x<(r.sx+r.ex)/2+3?(r.change_status("status_resize_bottom"),r.is_dragging=!0,r.is_drawing_finished=!1,r.selected_node="b"):r.selected_node!="body"&&(r.selected_node=null)))}),$(e).find("canvas").mousemove(function(e){if(!r.focus)return!1;var t=$(this).parent().offset();x=Math.floor(e.pageX-t.left),y=Math.floor(e.pageY-t.top);if(!r.is_drawing_finished&&r.is_dragging){if(r.selected_node=="body")r.sx+=x-r.previous_x,r.sy+=y-r.previous_y,r.ex+=x-r.previous_x,r.ey+=y-r.previous_y,r.previous_x=x,r.previous_y=y;else if(r.selected_node=="tl")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.sx=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.sy=r.ey-parseInt(s)}else r.sx=x,r.sy=y;else if(r.selected_node=="t")if(r.proportion){var n=r.proportion[0]/r.proportion[1];r.sy=y;var s=Math.abs(r.ey-r.sy),i=s*n,o=(r.sx+r.ex)/2;r.sx=o-parseInt(i/2),r.ex=o+parseInt(i/2)}else r.sy=y;else if(r.selected_node=="tr")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.ex=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.sy=r.ey-parseInt(s)}else r.ex=x,r.sy=y;else if(r.selected_node=="r")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.ex=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.ey=r.sy+parseInt(s)}else r.ex=x;else if(r.selected_node=="br")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.ex=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.ey=r.sy+parseInt(s)}else r.ex=x,r.ey=y;else if(r.selected_node=="b")if(r.proportion){var n=r.proportion[0]/r.proportion[1];r.ey=y;var s=Math.abs(r.ey-r.sy),i=s*n,o=(r.sx+r.ex)/2;r.sx=o-parseInt(i/2),r.ex=o+parseInt(i/2)}else r.ey=y;else if(r.selected_node=="bl")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.sx=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.ey=r.sy+parseInt(s)}else r.sx=x,r.ey=y;else if(r.selected_node=="l")if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.sx=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.ey=r.sy+parseInt(s)}else r.sx=x;else if(r.proportion){var n=r.proportion[1]/r.proportion[0];r.ex=x;var i=Math.abs(r.ex-r.sx),s=i*n;r.ey=r.sy+parseInt(s)}else r.ex=x,r.ey=y;r.draw_square(r.sx,r.sy,r.ex,r.ey)}r.sy-3<y&&y<r.sy+3&&r.sx-3<x&&x<r.sx+3?r.change_status("status_resize_top_left"):r.sy-3<y&&y<r.sy+3&&r.ex-3<x&&x<r.ex+3?r.change_status("status_resize_top_right"):r.ey-3<y&&y<r.ey+3&&r.ex-3<x&&x<r.ex+3?r.change_status("status_resize_bottom_right"):r.ey-3<y&&y<r.ey+3&&r.sx-3<x&&x<r.sx+3?r.change_status("status_resize_bottom_left"):(r.sy+r.ey)/2-3<y&&y<(r.sy+r.ey)/2+3&&r.sx-3<x&&x<r.sx+3?r.change_status("status_resize_left"):(r.sy+r.ey)/2-3<y&&y<(r.sy+r.ey)/2+3&&r.ex-3<x&&x<r.ex+3?r.change_status("status_resize_right"):r.sy-3<y&&y<r.sy+3&&(r.sx+r.ex)/2-3<x&&x<(r.sx+r.ex)/2+3?r.change_status("status_resize_top"):r.ey-3<y&&y<r.ey+3&&(r.sx+r.ex)/2-3<x&&x<(r.sx+r.ex)/2+3&&r.change_status("status_resize_bottom")}),$(e).find("canvas").mouseup(function(e){if(!r.focus)return!1;if(e.which==1)!r.is_drawing_finished&&r.is_dragging&&(r.is_dragging=!1,r.is_drawing_finished=!0,r.sx&&(r.sx=parseInt(r.sx)),r.sy&&(r.sy=parseInt(r.sy)),r.ex&&(r.ex=parseInt(r.ex)),r.ey&&(r.ey=parseInt(r.ey)),r.x=r.sx,r.y=r.sy,r.width=Math.abs(r.ex-r.sx),r.height=Math.abs(r.ey-r.sy),r.status="modified"),r.change_status("status_default");else if(e.which==3)return e.preventDefault(),e.stopPropagation(),!1;r.clear()}),$(e).find("canvas").click(function(e){if(!r.focus)return!1;if(e.which==3)return e.preventDefault(),e.stopPropagation(),!1}),this},draw_square:function(e,t,n,r){e&&(e=parseInt(e)),t&&(t=parseInt(t)),n&&(n=parseInt(n)),r&&(r=parseInt(r));if($(this.target).find("canvas").getContext){var i=$(this.target).find("canvas").getContext("2d");i.clearRect(0,0,$(this.target).find("canvas").width(),$(this.target).find("canvas").height())}},clear:function(){if($(this.target).find("canvas").getContext){var e=$(this.target).find("canvas").getContext("2d");e.clearRect(0,0,$(this.target).find("canvas").width(),$(this.target).find("canvas").height())}},remove:function(){this.target=null,this.timestamp=null,this.focus=null,this.is_dragging=null,this.is_drawing_finished=null,this.selected_node=null,this.sx=null,this.sy=null,this.ex=null,this.ey=null,this.previous_x=null,this.previous_y=null,this.id=null,this.name=null,this.x=null,this.y=null,this.width=null,this.height=null,this.connector=null,delete this},change_status:function(e){$(this.target).removeClass("status_default"),$(this.target).removeClass("status_drawing_line"),$(this.target).removeClass("status_drawing_square"),$(this.target).removeClass("status_move"),$(this.target).removeClass("status_resize_top_left"),$(this.target).removeClass("status_resize_top_right"),$(this.target).removeClass("status_resize_bottom_left"),$(this.target).removeClass("status_resize_bottom_right"),$(this.target).removeClass("status_resize_top"),$(this.target).removeClass("status_resize_bottom"),$(this.target).removeClass("status_resize_left"),$(this.target).removeClass("status_resize_right"),$(this.target).addClass(e)},move:function(e,t){this.sx+=e,this.sy+=t,this.ex+=e,this.ey+=t,self.status="modified"}};