/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.project.property=function(){this.dialog=null,this.tabview=null,this.treeview=null,this.buttons=null,this.manager=null,this.property=null,this.plugin=null},org.goorm.core.project.property.prototype={init:function(){var e=this;this.manager=new org.goorm.core.project.property.manager,this.manager.xml_parser("configs/project/property/default.xml"),this.xml=this.manager.xml,this.property={},this.plugin={},this.dialog=new org.goorm.core.project.property.dialog;var t=function(){var t=1;$("#property_tabview").find("input").each(function(){var n=$(this);if($(this).attr("validate")){var r=$(this).attr("validate").split(",");for(var i=0;i<r.length;i++){if(!t)return!1;t=e.manager.validate(n,r[i])}}t&&($(this).attr("type")=="checkbox"?$(this).attr("checked")==1?e.property[$(this).attr("name")]="true":e.property[$(this).attr("name")]="false":e.property[$(this).attr("name")]=$(this).val())}),$("#property_tabview").find("textarea").each(function(){var n=$(this).val();t&&(e.property[$(this).attr("name")]=$(this).val())}),$("#property_tabview").find("select").each(function(){e.property[$(this).attr("name")]=$(this).text()}),t&&(e.save_project_xml(),this.hide())},n=function(){this.hide(),e.set_before()};this.buttons=[{text:"OK",handler:t,isDefault:!0},{text:"Cancel",handler:n}],this.dialog=new org.goorm.core.project.property.dialog,this.dialog.init({title:"Project Property",path:"configs/dialogs/org.goorm.core.project/project.property.html",width:700,height:500,modal:!0,buttons:this.buttons,success:function(){e.manager.create_treeview(e.xml);for(var t=0;t<core.module.plugin_manager.list.length;t++){var n=core.module.plugin_manager.list[t].plugin_name;n=$(e.manager.xml).find("plugin").attr("name"),e.plugin[n]=new e.manager.plugin(core.module.plugin_manager.list[t].plugin_name),e.plugin[n].xml=e.manager.xml}$("#property_tabview #Information").show(),e.manager.treeview.subscribe("clickEvent",function(e){var t=e.node.label;t=t.replace(/[/#. ]/g,""),$("#property_tabview").children().hide(),$("#property_tabview #property_"+t).show()})}}),this.dialog=this.dialog.dialog},show:function(){var e=this;core.status.current_project_path!=null&&core.status.current_project_path!=""&&(this.set_project_information(),this.dialog.panel.show())},refresh_toolbox:function(){$(".toolsets").hide();var e=null;core.module.layout.workspace.window_manager.active_window>-1&&(e=core.module.layout.workspace.window_manager.window[core.module.layout.workspace.window_manager.active_window].filetype);if(core.status.current_project_type){for(var t in core.module.plugin_manager.plugins)if("org.goorm.plugin."+core.status.current_project_type.toLowerCase()==t){core.module.plugin_manager.plugins["org.goorm.plugin."+core.status.current_project_type.toLowerCase()].refresh_toolbox?(core.module.plugin_manager.plugins["org.goorm.plugin."+core.status.current_project_type.toLowerCase()].refresh_toolbox(),toolbox_button_menu&&toolbox_button_menu.set("label",core.module.plugin_manager.plugins[t].toolbox_name)):$("#"+core.status.current_project_type.toLowerCase()+"_toolset").show();break}}else if(e)for(var t in core.module.plugin_manager.plugins)if(typeof core.module.plugin_manager.plugins[t].filetypes!="undefined"&&core.module.plugin_manager.plugins[t].filetypes.indexOf(e)>-1){core.module.plugin_manager.plugins["org.goorm.plugin."+core.module.plugin_manager.plugins[t].name].refresh_toolbox?core.module.plugin_manager.plugins["org.goorm.plugin."+core.module.plugin_manager.plugins[t].name].refresh_toolbox():$("#"+core.module.plugin_manager.plugins[t].name+"_toolset").show();break}},set_project_information:function(){var e=this;this.property={};var t={project_path:core.status.current_project_path};$.get("project/get_property",t,function(e){e.err_code!=0&&alert.show(e.message)})},set_before:function(){var e=this;$("#property_tabview").find("input").each(function(){e.property[$(this).attr("name")]!=null&&($(this).attr("type")=="checkbox"?e.property[$(this).attr("name")]=="true"?$(this).attr("checked",!0):$(this).attr("checked",!1):$(this).val(e.property[$(this).attr("name")]))}),$("#property_tabview").find("textarea").each(function(){e.property[$(this).attr("name")]!=null&&$(this).val(e.property[$(this).attr("name")])}),$("#property_tabview").find("select").each(function(){e.property[$(this).attr("name")]!=null&&($(this).children("option[value = "+e.property[$(this).attr("name")]+"]").attr("selected","ture"),$(this).val(e.property[$(this).attr("name")]))})},get_property:function(e){var t=this;$(e).find("project").each(function(){$(this).find("property").length>0&&$(this).find("property").each(function(){t.property[$(this).attr("name")]=$(this).attr("default")})})},save_project_xml:function(e){var t=this;t.property.project_path=core.status.current_project_path;var n=JSON.stringify(t.property);$.ajax({type:"POST",data:"data="+n,url:"./module/org.goorm.core.project/project.property.ok.php",success:function(t){typeof e=="function"&&e()}})}};