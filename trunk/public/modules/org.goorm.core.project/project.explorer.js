/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.project.explorer=function(){this.target=null,this.treeview=null,this.context_menu_file=null,this.context_menu_folder=null,this.context_menu_project=null,this.current_tree_data=null,this.current_project=null,this.project_data=null},org.goorm.core.project.explorer.prototype={init:function(){var self=this;$("#project_explorer").prepend("<div id='project_selector'></div>"),$("#project_selector").append("<label class='selectbox'><select id='project_selectbox'></select></label>"),$("#project_selectbox").change(function(){self.on_project_selectbox_change($(this).val())}),$.get("project/get_list","",function(e){self.project_data=e,self.make_project_selectbox()}),$("#project_explorer").append("<div id='project_treeview' style='overflow-x:hidden'></div>");var postdata={kind:"project",path:""+core.status.current_project_path};$.get("file/get_nodes",postdata,function(data){if(data!=null){var sorting_data=eval(data);self.sort_project_treeview(sorting_data),self.treeview=new YAHOO.widget.TreeView("project_treeview",sorting_data),self.current_tree_data=self.treeview.getTreeDefinition(),self.treeview.subscribe("clickEvent",function(e){return!1}),self.treeview.subscribe("dblClickEvent",function(e){if(e.node.data.cls=="file"){var t=e.node.data.filename,n=e.node.data.filetype,r=e.node.data.parent_label;core.module.layout.workspace.window_manager.open(r,t,n)}else e.node.data.cls=="folder"&&(e.node.expanded?e.node.collapse():e.node.expand())}),self.treeview.render(),self.treeview.subscribe("expandComplete",function(){self.refresh_context_menu(),self.current_tree_data=self.treeview.getTreeDefinition()}),self.set_context_menu()}}),$(core).bind("goorm_load_complete",function(){self.current_project={},$.isEmptyObject(localStorage.current_project)||(self.current_project=$.parseJSON(localStorage.current_project),self.current_project.current_project_name!=""&&core.dialog.open_project.open(self.current_project.current_project_path,self.current_project.current_project_name,self.current_project.current_project_type))})},refresh:function(){var self=this;$.get("project/get_list","",function(e){self.project_data=e,self.make_project_selectbox()});var temp_project_path=core.status.current_project_path;$("#project_treeview").css("background-color","#FFF");var postdata={kind:"project",path:""+temp_project_path};$.get("file/get_nodes",postdata,function(data){var sorting_data=eval(data);self.sort_project_treeview(sorting_data),self.treeview.removeChildren(self.treeview.getRoot(),!0),self.expand_treeview(self.current_tree_data,sorting_data),self.treeview.buildTreeFromObject(sorting_data),self.treeview.render(),self.refresh_context_menu()})},expand_treeview:function(e,t){var n=this;$(e).each(function(e){if(this.expanded==1&&this.cls=="folder"){var r=this;$(t).each(function(e){r.filename==this.filename&&this.cls=="folder"&&(this.expanded=!0,n.expand_treeview(r.children,this.children))})}})},make_project_selectbox:function(){var e=this;$("#project_selectbox").empty(),$("#project_selectbox").append("<option value='' selected>Select Project</option>");var t=parseInt($("#project_selector").width()/8);for(var n=0;n<e.project_data.length;n++){var r=e.project_data[n].name;r.length>t&&(r=r.substring(0,t-1),r+=" â€¦"),e.project_data[n].name==core.status.current_project_path?$("#project_selectbox").append("<option value='"+n+"' selected>"+r+"</option>"):$("#project_selectbox").append("<option value='"+n+"'>"+r+"</option>")}},on_project_selectbox_change:function(e){var t=this;e!=""?(t.current_project.current_project_path=t.project_data[e].name,t.current_project.current_project_name=t.project_data[e].contents.name,t.current_project.current_projectType=t.project_data[e].contents.type,core.dialog.open_project.open(t.current_project.current_project_path,t.current_project.current_project_name,t.current_project.current_projectType)):(core.current_project_name="",core.status.current_project_path="",core.current_projectType="",t.current_project.current_project_path="",t.current_project.current_project_name="",t.current_project.current_projectType="",core.dialog.open_project.open(t.current_project.current_project_path,t.current_project.current_project_name,t.current_project.current_projectType))},sort_project_treeview:function(e){},set_context_menu:function(){var e=this;e.context_menu_file=new org.goorm.core.menu.context,e.context_menu_file.init("configs/menu/org.goorm.core.project/project.explorer.file.html","project.explorer.file","",null,null),e.context_menu_folder=new org.goorm.core.menu.context,e.context_menu_folder.init("configs/menu/org.goorm.core.project/project.explorer.folder.html","project.explorer.folder","",null,null),e.context_menu_project=new org.goorm.core.menu.context,e.context_menu_project.init("configs/menu/org.goorm.core.project/project.explorer.html","project.explorer","",null,null),e.refresh_context_menu()},refresh_context_menu:function(){var e=this;$("#project_treeview").unbind("mousedown"),$("#project_treeview").mousedown(function(t){e.context_menu_file.hide(),e.context_menu_project.hide(),e.context_menu_folder.hide(),$("#project_treeview").find(".ygtvfocus").removeClass("ygtvfocus");if(t.which==3){var n=0;$(window).height()-36<t.clientY+$("div[id='project.explorer']").height()&&(n=t.clientY+$("div[id='project.explorer']").height()-$(window).height()+36),e.context_menu_project.show(),$("div[id='project.explorer']").css("left",t.clientX),$("div[id='project.explorer']").css("top",t.clientY-n)}return core.status.selected_file=null,t.stopPropagation(),t.preventDefault(),!1}),$("#project_treeview").find(".ygtvcell").unbind("mousedown"),$("#project_treeview").find(".ygtvcell").mousedown(function(t){e.context_menu_project.hide(),e.context_menu_file.hide(),e.context_menu_folder.hide(),$(this).hasClass("ygtvfocus")==0&&($("#project_treeview").find(".ygtvfocus").removeClass("ygtvfocus"),$(this).hasClass("ygtvcontent")&&($(this).prev().addClass("ygtvfocus"),$(this).addClass("ygtvfocus"))),core.status.selected_file=$(this).find(".fullpath").html();if(t.which==3)if($(this).find("img").hasClass("file")){var n=0;$(window).height()-36<t.clientY+$("div[id='project.explorer.file']").height()&&(n=t.clientY+$("div[id='project.explorer.file']").height()-$(window).height()+36),e.context_menu_file.show(),$("div[id='project.explorer.file']").css("left",t.clientX),$("div[id='project.explorer.file']").css("top",t.clientY-n)}else if($(this).find("img").hasClass("folder")){var n=0;$(window).height()-36<t.clientY+$("div[id='project.explorer.folder']").height()&&(n=t.clientY+$("div[id='project.explorer.folder']").height()-$(window).height()+36),e.context_menu_folder.show(),$("div[id='project.explorer.folder']").css("left",t.clientX),$("div[id='project.explorer.folder']").css("top",t.clientY-n)}return t.stopPropagation(),t.preventDefault(),!1}),core.module.action.init()}};