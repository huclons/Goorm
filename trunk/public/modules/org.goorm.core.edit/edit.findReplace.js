/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 * version: 3.0.0
 * This is the module example for YUI_DOCS
 * @module edit
 **//**
 * This offers functionality about find/replace .
 * @class findReplace
 * @extends edit
 **/org.goorm.core.edit.findReplace=function(){this.dialog=null,this.buttons=null,this.editor=null,this.lastPos=null,this.lastQuery=null,this.marked=[],this.matchCase=!1,this.ignoreWhitespace=!1,this.useRE=!1,this.replaceCursor=null},org.goorm.core.edit.findReplace.prototype={init:function(){var e=this;this.buttons=[{text:"Find",handler:function(){e.find()}},{text:"Find All",handler:function(){e.findAll()}},{text:"Replace/Find",handler:function(){e.handleReplaceF()}},{text:"Replace",handler:function(){e.handleReplace()}},{text:"Replace All",handler:function(){e.handleReplaceAll()}},{text:"Close",handler:function(){e.hide()}}],this.dialog=new org.goorm.core.edit.findReplace.dialog,this.dialog.init({title:"Find/Replace",path:"configs/dialogs/org.goorm.core.edit/edit.findReplace.html",width:550,height:300,modal:!1,buttons:this.buttons,draggable:!0,success:function(){$("#findQueryInputBox").keydown(function(t){var n=t||event;if(n.keyCode==13)return e.find(),t.stopPropagation(),t.preventDefault(),!1}),e.dialog.panel.hideEvent.subscribe(function(t){e.unmark()}),$("#matchCase").change(function(){$("#matchCase")[0].checked==1?e.matchCase=!0:e.matchCase=!1}),$("#matchCaseCheckBoxName").click(function(){$("#matchCase")[0].checked==1?($("#matchCase")[0].checked=!1,e.matchCase=!1):($("#matchCase")[0].checked=!0,e.matchCase=!0)}),$("#ignoreWhitespace").change(function(){$("#ignoreWhitespace")[0].checked==1?e.ignoreWhitespace=!0:e.ignoreWhitespace=!1}),$("#ignoreWhitespaceCheckBoxName").click(function(){$("#ignoreWhitespace")[0].checked==1?($("#ignoreWhitespace")[0].checked=!1,e.ignoreWhitespace=!1):($("#ignoreWhitespace")[0].checked=!0,e.ignoreWhitespace=!0)}),$("#useRE").change(function(t){$("#useRE")[0].checked==1?(e.useRE=!0,$("#matchCase")[0].disabled=!0,$("#ignoreWhitespace")[0].disabled=!0):(e.useRE=!1,$("#matchCase")[0].disabled=!1,$("#ignoreWhitespace")[0].disabled=!1)}),$("#useRECheckBoxName").click(function(){$("#useRE")[0].checked==1?($("#useRE")[0].checked=!1,e.useRE=!1,$("#matchCase")[0].disabled=!1,$("#ignoreWhitespace")[0].disabled=!1):($("#useRE")[0].checked=!0,e.useRE=!0,$("#matchCase")[0].disabled=!0,$("#ignoreWhitespace")[0].disabled=!0)})}}),this.dialog=this.dialog.dialog},find:function(e){var t=core.mainLayout.workSpace.windowManager;if(t.window[t.activeWindow].editor){var n=t.window[t.activeWindow].editor.editor,r=$("#findQueryInputBox").val();this.search(r,n,e)}},findAll:function(){var e=core.mainLayout.workSpace.windowManager;if(e.window[e.activeWindow].editor){var t=e.window[e.activeWindow].editor.editor,n=$("#findQueryInputBox").val();this.searchAll(n,t)}},handleReplaceF:function(){var e=core.mainLayout.workSpace.windowManager;if(e.window[e.activeWindow].editor){var t=e.window[e.activeWindow].editor.editor,n=$("#findQueryInputBox").val(),r=$("#replaceQueryInputBox").val();this.replace(n,r,t),this.search(n,t)}},handleReplace:function(){var e=core.mainLayout.workSpace.windowManager;if(e.window[e.activeWindow].editor){var t=e.window[e.activeWindow].editor.editor,n=$("#findQueryInputBox").val(),r=$("#replaceQueryInputBox").val();this.replace(n,r,t)}},handleReplaceAll:function(){var e=core.mainLayout.workSpace.windowManager;if(e.window[e.activeWindow].editor){var t=e.window[e.activeWindow].editor.editor,n=$("#findQueryInputBox").val(),r=$("#replaceQueryInputBox").val();this.replaceAll(n,r,t)}},search:function(e,t,n){if(!e)return;var r=e,i=!0;this.useRE==1?r=RegExp(e,"g"):(this.matchCase==1&&(i=!1),this.ignoreWhitespace==1&&(r=r.replace(/\s*/g,""))),this.unmark();for(var s=t.getSearchCursor(r,null,i);s.findNext();)this.marked.push(t.markText(s.from(),s.to(),"searched"));this.lastQuery!=r&&(this.lastPos=null);var s=t.getSearchCursor(r,this.lastPos?this.lastPos:t.getCursor(),i);if(n=="previous"){s.findPrevious();if(s.findPrevious()==0){for(s=t.getSearchCursor(r,null,i);s.findNext(););s.findPrevious();if(!t.getSearchCursor(r,null,i).findNext())return}}else if(!s.findNext()){s=t.getSearchCursor(r,null,i);if(!s.findNext())return}t.setSelection(s.from(),s.to()),this.replaceCursor=s,this.lastQuery=r,this.lastPos=s.to()},searchAll:function(e,t){if(!e)return;var n=e,r=!0;this.useRE==1?n=RegExp(e,"g"):(this.matchCase==1&&(r=!1),this.ignoreWhitespace==1&&(n=n.replace(/\s*/g,""))),core.mainLayout.innerBottomTabView.selectTab(3),core.searchTab.clean();var i=[];this.unmark();for(var s=t.getSearchCursor(n,null,r);s.findNext();){this.marked.push(t.markText(s.from(),s.to(),"searched"));var o={fline:s.from().line,fch:s.from().ch,tline:s.to().line,tch:s.to().ch};i.push(o)}for(var u=i.length-1;u>-1;u--)core.searchTab.m(i[u].fline,i[u].fch,i[u].tline,i[u].tch,t.getLine(i[u].fline));this.dialog.panel.hide(),$(".searchMessage").click(function(){$(".searchMessage").css("background-color",""),$(this).css("background-color","#fff8dc");var e=parseInt($(this).attr("fline")),n=parseInt($(this).attr("fch")),r=parseInt($(this).attr("tline")),i=parseInt($(this).attr("tch")),s={line:e,ch:n},o={line:r,ch:i};t.setSelection(s,o)})},replaceSearch:function(e,t,n){if(!e)return;var r=e,i=t,s=!0;this.useRE==1?r=RegExp(e,"g"):(this.matchCase==1&&(s=!1),this.ignoreWhitespace==1&&(r=r.replace(/\s*/g,""))),this.unmark();for(var o=n.getSearchCursor(r,null,s);o.findNext();)this.marked.push(n.markText(o.from(),o.to(),"searched"));this.lastQuery!=r&&(this.lastPos=null);var o=n.getSearchCursor(r,n.getCursor()||this.lastPos,s);if(!o.findNext()){o=n.getSearchCursor(r,null,s);if(!o.findNext())return}n.setSelection(o.from(),o.to()),this.lastQuery=r,this.lastPos=o.to()},replace:function(e,t,n){if(!e)return;var r=e,i=t,s=!0;this.useRE==1?r=RegExp(e,"g"):(this.matchCase==1&&(s=!1),this.ignoreWhitespace==1&&(r=r.replace(/\s*/g,""))),this.unmark();var o=n.getSearchCursor(r,this.lastPos,s);o.findPrevious(),n.replaceRange(i,o.from(),o.to())},replaceAll:function(e,t,n){if(!e)return;var r=e,i=t,s=!0;this.useRE==1?r=RegExp(e,"g"):(this.matchCase==1&&(s=!1),this.ignoreWhitespace==1&&(r=r.replace(/\s*/g,""))),core.mainLayout.innerBottomTabView.selectTab(3),core.searchTab.clean(),this.unmark();for(var o=n.getSearchCursor(r,null,s);o.findNext();)n.replaceRange(i,o.from(),o.to()),core.searchTab.mReplaceAll(o.from().line,o.from().ch,o.to().line,o.to().ch,r,i);this.dialog.panel.hide(),$(".searchMessage").click(function(){$(".searchMessage").css("background-color",""),$(this).css("background-color","#fff8dc");var e=parseInt($(this).attr("fline")),t=parseInt($(this).attr("fch")),r=parseInt($(this).attr("tline")),s=parseInt($(this).attr("tch")),o={line:e,ch:t},u={line:r,ch:t+i.length};n.setSelection(o,u)})},unmark:function(){for(var e=0;e<this.marked.length;++e)this.marked[e].clear();this.marked.length=0},show:function(){this.dialog.panel.show();var e=core.mainLayout.workSpace.windowManager;if(e.window[e.activeWindow].editor){var t=e.window[e.activeWindow].editor.editor;$("#findQueryInputBox").val(t.getSelection())}$("#findQueryInputBox").select()},hide:function(){this.dialog.panel.hide()}};