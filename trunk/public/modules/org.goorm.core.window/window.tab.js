/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.window.tab=function(){this.tabview=null,this.list_menu=null,this.tab=null,this.menuitem=null,this.window=null,this.context_menu=null,this.title=null,this.is_saved=null},org.goorm.core.window.tab.prototype={init:function(e,t,n,r){var i=this;this.is_saved=!0,this.tabview=n,this.list_menu=r,this.title=t,this.tab=new YAHOO.widget.Tab({label:"<span class='tabtitle' style='float:left'>"+this.title+"</span> <div class='window_buttons'><div class='close tab_close_button window_button'></div></div>",content:""}),this.tabview.addTab(this.tab),this.tabview.selectTab(this.tabview.getTabIndex(this.tab)),this.menuitem=new YAHOO.widget.MenuItem("window_list_menu",{text:this.title,onclick:{fn:function(){i.activate()}}}),this.list_menu.addItem(this.menuitem),this.list_menu.render(),this.context_menu=new org.goorm.core.menu.context,this.context_menu.init("configs/menu/org.goorm.core.window/window.tab.html","window.tab",this.tab.get("labelEl"),this.title,null,function(){i.set_event()})},set_event:function(){var e=this,t=e.context_menu.name.replace(/[/.]/g,"\\.");$(this.tab.get("labelEl")).mousedown(function(n){if(n.which===3)return $("#"+e.window.container+"_c").css("display")=="none"?($("#"+t).find(".unminimize").removeClass("yuimenuitemlabel-disabled"),$("#"+t).find(".unminimize").parent().removeClass("yuimenuitem-disabled"),$("#"+t).find(".minimize").addClass("yuimenuitemlabel-disabled"),$("#"+t).find(".minimize").parent().addClass("yuimenuitem-disabled")):($("#"+t).find(".unminimize").addClass("yuimenuitemlabel-disabled"),$("#"+t).find(".unminimize").parent().addClass("yuimenuitem-disabled"),$("#"+t).find(".minimize").removeClass("yuimenuitemlabel-disabled"),$("#"+t).find(".minimize").parent().removeClass("yuimenuitem-disabled")),!1}),$(this.tab.get("labelEl")).click(function(t){if(t.which==1)return e.activate(),t.stopPropagation(),t.preventDefault(),!1}),$(this.tab.get("labelEl")).find(".close").click(function(t){if(t.which==1)return e.close(),!1}),$("#"+t).find(".close").click(function(t){if(t.which==1)return e.context_menu.hide(),e.close(),!1}),$("#"+t).find(".minimize").click(function(t){if(t.which==1)return e.context_menu.hide(),e.window.minimize(),!1}),$("#"+t).find(".unminimize").click(function(t){if(t.which==1)return $(this).hasClass("yuimenuitemlabel-disabled")||(e.context_menu.hide(),e.activate()),!1})},set_modified:function(){var e=$(this.tab.get("labelEl")).find(".tabtitle").text();e=e.replace(" *",""),$(this.tab.get("labelEl")).find(".tabtitle").html(e+" *"),this.is_saved=!1},set_saved:function(){var e=$(this.tab.get("labelEl")).find(".tabtitle").text();$(this.tab.get("labelEl")).find(".tabtitle").html(e.replace(" *","")),this.is_saved=!0},connect:function(e){this.window=e},close:function(){var e=this;this.is_saved?(this.tabview.removeTab(this.tab),this.list_menu.removeItem(this.menuitem),this.context_menu.remove(),this.window&&(this.window.tab=null,this.window.close()),delete this):(confirmation_save.init({title:core.module.localization.msg.confirmation_save_title,message:'"'+this.window.filename+'" '+core.module.localization.msg.confirmation_save_message,yes_text:core.module.localization.msg.confirmation_yes,cancel_text:core.module.localization.msg.confirmation_cancel,no_text:core.module.localization.msg.confirmation_no,yes:function(){e.window.editor.save("close")},cancel:function(){},no:function(){e.is_saved=!0,e.window.is_saved=!0,e.close()}}),confirmation_save.panel.show())},activate:function(){this.tabview.selectTab(this.tabview.getTabIndex(this.tab)),$("#window_list_menu").find(".yuimenuitem-checked").each(function(e){$(this).removeClass("yuimenuitem-checked")}),$(this.menuitem.element).addClass("yuimenuitem-checked");if(this.window){core.module.toolbar.switch_state(this.window.type),this.window.show();if(!$("#"+this.window.container).find(".hd").hasClass("activated")){for(var e=0;e<core.module.layout.workspace.window_manager.index;e++)if(core.module.layout.workspace.window_manager.window[e].alive&&core.module.layout.workspace.window_manager.window[e]==this.window){core.module.layout.workspace.window_manager.active_window=e;break}this.window.activate()}}}};