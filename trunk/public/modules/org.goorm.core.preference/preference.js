/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 * version: 3.0.0
 **/org.goorm.core.preference=function(){this.dialog=null,this.tabview=null,this.treeview=null,this.buttons=null,this.manager=null,this.ini=null,this.plugin=null,this.preference=null,this.firstShow=!0,this.grid_opacity_slider=null,this.preference_default=null},org.goorm.core.preference.prototype={init:function(){var e=this;this.manager=new org.goorm.core.preference.manager,this.manager.init(),this.dialog=new org.goorm.core.preference.dialog,this.load_default(),console.log("default Preference loaded")},load_default:function(){var e=this;this.manager.get_default_file("configs/preferences/default.json",function(t){e.preference=t,core.preference=t,e.preference_default=t,e.load()})},load_preference:function(e){this.manager.get_default_file(e,function(e){$.extend(!0,core.preference,e)})},load:function(){$.each(core.preference,function(e,t){$.isEmptyObject(localStorage[e])||(core.preference[e]=localStorage[e])})},save:function(){$.each(core.preference,function(e,t){e!="share"&&(localStorage[e]=t)})},apply:function(e){var t=this,n="#preference_tabview";e&&(n+=" #"+e),this.read_dialog(core.preference),$(document).trigger("on_preference_confirmed"),$(core.module.layout.workspace.window_manager.window).each(function(e){this.alive&&this.designer&&(t.preference["preference.designer.show_preview"]=="true"?this.designer.canvas.toolbar.is_preview_on=!1:this.designer.canvas.toolbar.is_preview_on=!0,this.designer.canvas.toolbar.toggle_preview(),t.preference["preference.designer.show_grid"]=="true"?this.designer.canvas.toolbar.is_grid_on=!1:this.designer.canvas.toolbar.is_grid_on=!0,this.designer.canvas.toolbar.toggle_grid(),t.preference["preference.designer.show_ruler"]=="true"?this.designer.canvas.toolbar.is_ruler_on=!1:this.designer.canvas.toolbar.is_ruler_on=!0,this.designer.canvas.toolbar.toggle_ruler(),t.preference["preference.designer.snap_to_grid"]=="true"?this.designer.canvas.snap_to_grid=!1:this.designer.canvas.snap_to_grid=!0,this.designer.canvas.toolbar.toggle_snap_to_grid(),this.designer.canvas.toolbar.change_grid_unit(t.preference["preference.designer.grid_unit"]),this.designer.canvas.toolbar.change_grid_opacity(t.preference["preference.designer.grid_opacity"]),this.designer.canvas.toolbar.change_ruler_unit(t.preference["preference.designer.ruler_unit"]))})},restore_default:function(e){var t=this,n="#preference_tabview",r={},i=0;this.fill_dialog(t.preference_default)},read_dialog:function(e){var t="#preference_tabview";$(t).find("input").each(function(){var t;$(this).attr("type")=="checkbox"?t=$(this).attr("checked")=="checked"?!0:!1:t=$(this).val(),e[$(this).attr("name")]=t}),$(t).find("textarea").each(function(){e[$(this).attr("name")]=$(this).val()}),$(t).find("select").each(function(){e[$(this).attr("name")]=$(this).children("option:selected").val()})},fill_dialog:function(e){$("#preference_tabview").find("input").each(function(){e[$(this).attr("name")]!==null&&($(this).attr("type")=="checkbox"?e[$(this).attr("name")]=="true"&&$(this).attr("checked","checked"):$(this).val(e[$(this).attr("name")]))}),$("#preference_tabview").find("textarea").each(function(){e[$(this).attr("name")]!==null&&$(this).val(e[$(this).attr("name")])}),$("#preference_tabview").find("select").each(function(){e[$(this).attr("name")]!==null&&($(this).children("option[value = "+e[$(this).attr("name")]+"]").attr("selected","true"),$(this).val(e[$(this).attr("name")]))})},show:function(){var e=this;this.dialog.panel.show(),this.set_before(),this.firstShow&&($("#preference_tabview #System").show(),this.firstShow=!1)},set_before:function(){this.load(),this.fill_dialog(core.preference)},init_dialog:function(){var e=this,t=function(){e.apply(),e.save(),this.hide()},n=function(){core.module.localization.before_language!=localStorage.getItem("language")&&core.module.localization.change_language(core.module.localization.before_language),e.set_before(),this.hide()};this.buttons=[{text:"OK",handler:t,isDefault:!0},{text:"Cancel",handler:n}],this.dialog.init({title:"Preference",path:"configs/dialogs/org.goorm.core.preference/preference.html",width:700,height:500,modal:!0,buttons:this.buttons,success:function(){$.getJSON("configs/dialogs/org.goorm.core.preference/tree.json",function(t){e.manager.create_treeview(t),e.manager.create_tabview(t),i(),e.manager.treeview.subscribe("clickEvent",function(t){var n=t.node.label;n=n.replace(/[/#. ]/,""),$("#preference_tabview > *").hide(),$("#preference_tabview #"+n).show(),n=="FileType"&&$(".filetype_list").find("div").first().trigger("click"),n=="Designer"&&(e.grid_opacity_slider.setValue(parseInt($("#grid_opacity_slider_value").val()*200)),$("#grid_opacity_slider_value_text").text($("#grid_opacity_slider_value").val()*100+"%"))}),e.grid_opacity_slider=YAHOO.widget.Slider.getHorizSlider("grid_opacity_sliderBg","grid_opacity_slider_thumb",0,200,20),e.grid_opacity_slider.animate=!0,e.grid_opacity_slider.getRealValue=function(){return(this.getValue()/200).toFixed(1)},e.grid_opacity_slider.subscribe("change",function(t){$("#grid_opacity_slider_value").val(e.grid_opacity_slider.getRealValue()),$("#grid_opacity_slider_value_text").text(e.grid_opacity_slider.getRealValue()*100+"%")});var n=new org.goorm.core.preference.info;n.init();var r=new org.goorm.core.preference.filetype;r.init(),$(core).trigger("preference_loading_complete"),console.log("preference dialog loaded")})}});var r=function(){$("#preference_tabview").find(".apply").each(function(t){$(this).attr("id","applyBt_"+t),new YAHOO.widget.Button("applyBt_"+t,{onclick:{fn:function(){e.apply($("#preference_tabview #applyBt_"+t).parents(".yui-navset").attr("id"))}}})}),$("#preference_tabview").find(".restore_default").each(function(t){$(this).attr("id","restore_defaultBt_"+t),new YAHOO.widget.Button("restore_defaultBt_"+t,{onclick:{fn:function(){e.restore_default($("#preference_tabview #restore_defaultBt_"+t).parents(".yui-navset").attr("id"))}}})})},i=function(){var t=null,n=core.module.plugin_manager.list,i=n.length;$.each(core.module.plugin_manager.list,function(n,s){var o=s.name;$.getJSON("/"+o+"/tree.json",function(n){t===null&&(t=e.manager.treeview.getNodeByProperty("label","Plugin")),$.isEmptyObject(n)||(e.manager.add_treeview(t,n),e.manager.add_tabview(n),e.manager.treeview.render(),e.manager.treeview.expandAll())}).complete(function(){--i==0&&r()})})};this.dialog=this.dialog.dialog}};