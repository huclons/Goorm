/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 * version: 3.0.0
 * This is the module example for YUI_DOCS
 * @module file
 **//**
 * This is an goorm code generator.  
 * goorm starts with this code generator.
 * @class saveAs
 * @extends file
 **/org.goorm.core.file.saveAs=function(){this.dialog=null,this.buttons=null,this.tabView=null,this.treeView=null,this.currentPath=null,this.isSaveAnyway=null},org.goorm.core.file.saveAs.prototype={init:function(){var e=this,t=function(){if($("#fileSaveAsInputFileName").attr("value")=="")return alert.show(core.localization.msg.alertFileNameEmpty),!1;var n="../../project/"+$("#fileSaveAsinputLocationPath").attr("value")+"/"+$("#fileSaveAsInputFileName").attr("value");$.ajax({url:"file/get_contents",type:"GET",data:{path:n},success:function(r){if(r!=0&&!e.isSaveAnyway)return confirmation.init({title:core.localization.msg.confirmationSaveAsTitle,message:core.localization.msg.confirmationSaveAsMessage,yesText:core.localization.msg.confirmationYes,noText:core.localization.msg.confirmationNo,yes:function(){e.isSaveAnyway=!0,t()},no:function(){}}),confirmation.panel.show(),!1;var i=core.mainLayout.workSpace.windowManager.window[core.mainLayout.workSpace.windowManager.activeWindow],s=$("#fileSaveAsInputFileName").attr("value");s=s.split("."),s=s[1];if(i.type=="Designer"){var o="put_file_contents",r=i.designer.getSource(i.designer.canvas.objects);$.ajax({url:o,type:"GET",data:{path:n,data:r},success:function(e){m.s("save as complete!","designer"),core.mainLayout.workSpace.windowManager.window[core.mainLayout.workSpace.windowManager.activeWindow].close(),core.mainLayout.workSpace.windowManager.open("../../project/"+$("#fileSaveAsinputLocationPath").attr("value")+"/",$("#fileSaveAsInputFileName").attr("value"),s),core.mainLayout.projectExplorer.refresh()}})}else if(i.type=="Editor"){var o="put_file_contents",r=i.editor.editor.getValue();$.ajax({url:o,type:"GET",data:{path:n,data:r},success:function(e){m.s("save as complete!","editor"),core.mainLayout.workSpace.windowManager.window[core.mainLayout.workSpace.windowManager.activeWindow].close(),core.mainLayout.workSpace.windowManager.open("../../project/"+$("#fileSaveAsinputLocationPath").attr("value")+"/",$("#fileSaveAsInputFileName").attr("value"),s),core.mainLayout.projectExplorer.refresh()}})}e.dialog.panel.hide()}})},n=function(){this.hide()};this.buttons=[{text:"Save",handler:t,isDefault:!0},{text:"Cancel",handler:n}],this.dialog=new org.goorm.core.file.saveAs.dialog,this.dialog.init({title:"Save as",path:"configs/dialogs/org.goorm.core.file/file.saveAs.html",width:800,height:500,modal:!0,buttons:this.buttons,success:function(){var e=new YAHOO.util.Resize("saveAsDialogLeft",{handles:["r"],minWidth:200,maxWidth:400});e.on("resize",function(e){var t=$("#saveAsDialogMiddle").width(),n=e.width;$("#saveAsDialogCenter").css("width",t-n-9+"px")})}}),this.dialog=this.dialog.dialog},show:function(){this.isSaveAnyway=!1;if(core.mainLayout.workSpace.windowManager.activeWindow<0)return alert.show(core.localization.msg.alertFileNotOpened),!1;this.refreshAll(),this.dialog.panel.show()},addDirectories:function(postdata){var self=this;$.post("file/get_nodes",postdata,function(data){var sortProjectTreeview=function(e){s.quickSort(e);for(i=0;i<e.length;i++)e[i].children&&s.quickSort(e[i].children)},sortingData=eval(data);sortProjectTreeview(sortingData);var newData=new Array;for(var name in sortingData)sortingData[name].cls=="folder"&&newData.push(sortingData[name]);self.treeView=new YAHOO.widget.TreeView("fileSaveAsTreeview",newData),self.treeView.subscribe("clickEvent",function(e){if(e.node.data.cls=="folder"){var t=e.node.data.filename,n=e.node.data.filetype,r=e.node.data.parentLabel,i=r+"/"+t;i=i.replace(/\.\.\/\.\.\/project\/\//,""),i=i.replace(/\.\.\/\.\.\/project\//,""),i="/"+i,i=i.replace(/\/\/\//,"/"),i=i.replace(/\/\//,"/"),self.currentPath=i,$("#fileSaveAsinputLocationPath").attr("value",i);var s={kind:"project",projectName:self.currentPath,folderOnly:"false"};self.addFileItems(s)}return!1}),self.treeView.subscribe("dblClickEvent",function(e){e.node.data.cls=="folder"&&(e.node.expanded?e.node.collapse():e.node.expand())}),self.treeView.render(),self.treeExpandComplete(),self.treeView.subscribe("expandComplete",function(){self.treeExpandComplete()}),self.currentPath==""&&($("#fileSaveAsTreeview").find(".ygtvdepth0").find(".ygtvcell").prev().addClass("ygtvfocus"),$("#fileSaveAsTreeview").find(".ygtvdepth0").find(".ygtvcell").addClass("ygtvfocus"))})},expandDirectory:function(e){$("#fileSaveAsTreeview").find(".ygtvfocus").parent().parent().parent().parent().find(".ygtvcell").each(function(){$(this).find(".fullpath").text().split("/").pop()==e&&($("#fileSaveAsTreeview").find(".ygtvfocus").removeClass("ygtvfocus"),$(this).prev().addClass("ygtvfocus"),$(this).addClass("ygtvfocus"))}),this.treeView.getNodeByElement($("#fileSaveAsTreeview").find(".ygtvfocus")[0]).expand()},treeExpandComplete:function(){$("#fileSaveAsTreeview").find(".ygtvcell").unbind("mousedown"),$("#fileSaveAsTreeview").find(".ygtvcell").mousedown(function(e){$(this).hasClass("ygtvfocus")==0&&($("#fileSaveAsTreeview").find(".ygtvfocus").removeClass("ygtvfocus"),$(this).hasClass("ygtvcontent")&&($(this).prev().addClass("ygtvfocus"),$(this).addClass("ygtvfocus")))})},addFileItems:function(postdata){$("#saveAsDialogCenter").empty();var self=this;$.post("file/get_nodes",postdata,function(data){var sortProjectTreeview=function(e){s.quickSort(e)},sortingData=eval(data);sortProjectTreeview(sortingData);for(var name in sortingData){var iconStr="";sortingData[name].cls=="folder"?iconStr+="<div class='folderitem'":iconStr+="<div class='fileitem'",iconStr+=" filename='"+sortingData[name].filename+"' filetype='"+sortingData[name].filetype+"' filepath='"+sortingData[name].parentLabel+"'>",sortingData[name].cls=="folder"?iconStr+="<img src='images/org.goorm.core.file/folder.png'>":iconStr+="<img src='images/org.goorm.core.file/file.png'>",iconStr+="<div style='word-break:break-all; width:60px; line-height:12px; margin-left:5px; margin-right:5px; margin-bottom:5px;'>",iconStr+=sortingData[name].filename,iconStr+="</div>",iconStr+="</div>",$("#saveAsDialogCenter").append(iconStr)}$("#saveAsDialogMiddle").find(".folderitem").dblclick(function(){self.currentPath=="/"&&(self.currentPath=""),self.currentPath=self.currentPath+"/"+$(this).attr("filename"),$("#fileSaveAsinputLocationPath").val(self.currentPath);var e={kind:"project",projectName:self.currentPath,folderOnly:"false"};self.addFileItems(e),self.expandDirectory($(this).attr("filename"))}),$("#saveAsDialogMiddle").find(".fileitem").click(function(){$("#saveAsDialogMiddle").find(".fileitem").removeClass("selectedItem"),$("#saveAsDialogMiddle").find(".folderitem").removeClass("selectedItem"),$(this).addClass("selectedItem")}),$("#saveAsDialogMiddle").find(".folderitem").click(function(){$("#saveAsDialogMiddle").find(".fileitem").removeClass("selectedItem"),$("#saveAsDialogMiddle").find(".folderitem").removeClass("selectedItem"),$(this).addClass("selectedItem")}),$("#saveAsDialogMiddle").find(".fileitem").click(function(){$("#fileSaveAsInputFileName").attr("value",$(this).attr("filename"))})})},refreshAll:function(){this.currentPath="/"+core.currentProjectPath,$("#fileSaveAsinputLocationPath").val(this.currentPath);var e={kind:"project",projectName:this.currentPath,folderOnly:"true"};this.addDirectories(e),e={kind:"project",projectName:this.currentPath,folderOnly:"false"},this.addFileItems(e)}};