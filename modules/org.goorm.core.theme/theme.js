var fs=require("fs"),walk=require("walk"),rimraf=require("rimraf"),EventEmitter=require("events").EventEmitter,exec=require("child_process").exec,themes=[];module.exports={init:function(){},get_list:function(e){var t=this;themes=[];var n={followLinks:!1},r=walk.walk(__path+"public/configs/themes",n);r.on("directories",function(n,r,i){var s=r.length;if(n==__path+"public/configs/themes"){var o=0,u=new EventEmitter;u.on("get_list",function(){o++,o<r.length?t.get_theme_info(r[o],u):e.emit("theme_get_list",themes)}),t.get_theme_info(r[o],u)}i()}),r.on("end",function(){})},get_theme_info:function(e,t){var n={};n.name=e.name,fs.readFile(__path+"public/configs/themes/"+n.name+"/theme.json","utf-8",function(e,r){e==null&&(n.contents=JSON.parse(r),themes.push(n)),t.emit("get_list")})},put_contents:function(e,t){var n={};fs.writeFile(__path+"public/configs/themes/"+e.path,e.data,function(e){e!=null?(n.err_code=10,n.message="Can not save",t.emit("theme_put_contents",n)):(n.err_code=0,n.message="saved",t.emit("theme_put_contents",n))})}};