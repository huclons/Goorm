/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.printer.design.preview=function(){this.canvas=null,this.panel=null,this.target=null,this.real_target=null,this.real_width=null,this.real_height=null,this.width=null,this.height=null,this.left=null,this.top=null,this.scale=null,this.parent=null,this.indicator_width=null,this.is_preview_clicked=null},org.goorm.core.printer.design.preview.prototype={init:function(e,t,n,r,i){var s=this;s.target=e,s.real_width=t,s.width=t*r,s.real_height=n,s.height=n*r,s.scale=r,s.parent=i,s.is_preview_clicked=!1,$(e).append("<div class='canvas'></div>"),$(e).find(".canvas").append("<div class='shapes' style='position:absolute; width:"+this.width+"px; height:"+this.height+"px;'></div>"),$(e).find(".canvas").append("<canvas width='"+s.width+"' height='"+s.height+"' style='position:absolute; background-color:transparent;'></canvas>"),$(e).prepend("<head><style></style></head>");var o="file/get_contents";$.ajax({url:o,type:"GET",data:"path=../../stencil/org.goorm.stencil.uml/stencil.uml.css",success:function(t){$(e).find("style").html(t)}})},draw:function(){var e=this,t=5;if($(this.target).find(".canvas").find("canvas")[0].getContext){var n=$(this.target).find(".canvas").find("canvas")[0].getContext("2d");n.clearRect(0,0,$(this.target).find(".canvas").find("canvas").width(),$(this.target).find(".canvas").find("canvas").height()),$(this.parent.objects).each(function(r){if(this.properties.timestamp==null){var i=e.parent.objects.slice(0,r),s=e.parent.objects.slice(r,e.parent.objects.length);s.shift(),e.parent.objects=i.concat(s)}if($(this)[0].type=="line"){var o=0,u=0,a=0,f=0;$(this)[0].properties.sx&&(o=parseInt($(this)[0].properties.sx*e.scale)),$(this)[0].properties.sy&&(u=parseInt($(this)[0].properties.sy*e.scale)),$(this)[0].properties.ex&&(a=parseInt($(this)[0].properties.ex*e.scale)),$(this)[0].properties.ey&&(f=parseInt($(this)[0].properties.ey*e.scale));if(!e.parent.multi_node_line){e.parent.hovered_index==r&&(n.beginPath(),n.strokeStyle="#FFFF00",n.moveTo(o,u),n.lineTo(a,f),parseFloat($(this)[0].properties.thickness)<.5?n.lineWidth=.5:n.lineWidth=(parseFloat($(this)[0].properties.thickness)+5)*e.scale,n.stroke()),n.beginPath(),n.strokeStyle=$(this)[0].properties.color;if(this.properties.dashed){var l=[5*parseFloat($(this)[0].properties.thickness),4*parseFloat($(this)[0].properties.thickness)],c=l.length,h,p,d=0,v=!0,m,g;a<o?(m=a,g=f):(m=o,g=u),h=a-o,p=f-u,n.moveTo(m,g),parseFloat($(this)[0].properties.thickness)<.5?n.lineWidth=.5:n.lineWidth=parseFloat($(this)[0].properties.thickness)*e.scale;var y=p/h,b=Math.sqrt(h*h+p*p);while(b>=.1){var w=l[d++%c];w>b&&(w=b);var E=Math.sqrt(w*w/(1+y*y));m+=E,g+=y*E,n[v?"lineTo":"moveTo"](m,g),b-=w,v=!v}n.stroke()}else n.moveTo(o,u),n.lineTo(a,f),parseFloat($(this)[0].properties.thickness)<.5?n.lineWidth=.5:n.lineWidth=parseFloat($(this)[0].properties.thickness)*e.scale,n.stroke();if($.inArray(r,e.parent.selected_index)>=0||e.parent.selected)n.beginPath(),n.strokeStyle="#666666",n.rect(o-3,u-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fillStyle="#FFFFFF",n.fill(),n.beginPath(),n.strokeStyle="#666666",n.rect(a-3,f-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fillStyle="#FFFFFF",n.fill();this.shape}else{n.beginPath(),n.strokeStyle=$(this)[0].properties.color;if(this.properties.dashed){var l=[5*parseFloat($(this)[0].properties.thickness),4*parseFloat($(this)[0].properties.thickness)],c=l.length,h,p,d=0,v=!0,m,g;a<o?(m=a,g=f):(m=o,g=u),h=a-o,p=f-u,n.moveTo(m,g),n.lineWidth=parseFloat($(this)[0].properties.thickness);var y=p/h,b=Math.sqrt(h*h+p*p);while(b>=.1){var w=l[d++%c];w>b&&(w=b);var E=Math.sqrt(w*w/(1+y*y));m+=E,g+=y*E,n[v?"lineTo":"moveTo"](m,g),b-=w,v=!v}n.stroke()}else n.moveTo(o,u),n.lineTo((o+a)/2,u),n.lineTo((o+a)/2,f),n.lineTo(a,f),n.lineWidth=parseFloat($(this)[0].properties.thickness),n.stroke();if($.inArray(r,e.parent.selected_index)>=0||e.parent.selected)n.beginPath(),n.strokeStyle="#666666",n.rect(o-3,u-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fillStyle="#FFFFFF",n.fill(),n.beginPath(),n.strokeStyle="#666666",n.rect(a-3,f-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fillStyle="#FFFFFF",n.fill();this.shape}}else if($(this)[0].type=="square"){var o=0,u=0,a=0,f=0;$(this)[0].properties.sx&&(o=parseInt($(this)[0].properties.sx/t)),$(this)[0].properties.sy&&(u=parseInt($(this)[0].properties.sy/t)),$(this)[0].properties.ex&&(a=parseInt($(this)[0].properties.ex/t)),$(this)[0].properties.ey&&(f=parseInt($(this)[0].properties.ey/t)),e.parent.hovered_index==r&&(n.beginPath(),n.strokeStyle="#FFFF00",n.rect(o,u,a-o,f-u),n.lineWidth=5,n.closePath(),n.stroke(),n.beginPath(),n.strokeStyle="#000000",n.fillStyle="#FFFFFF",n.rect(o,u,a-o,f-u),n.lineWidth=.5,n.closePath(),n.stroke()),n.beginPath(),n.strokeStyle="#000000",n.fillStyle="#FFFFFF",n.rect(o,u,a-o,f-u),n.lineWidth=.5,n.closePath(),n.stroke(),n.fill();if($.inArray(r,e.parent.selected_index)>=0||e.parent.selected)n.beginPath(),n.strokeStyle="#666666",n.fillStyle="#FFFFFF",n.rect(o-3,u-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect(a-3,u-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect(a-3,f-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect(o-3,f-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect((o+a)/2-3,f-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect((o+a)/2-3,u-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect(a-3,(u+f)/2-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill(),n.rect(o-3,(u+f)/2-3,6,6),n.closePath(),n.lineWidth=1,n.stroke(),n.fill()}})}},set_shape:function(e){var t=this;e.properties!=null&&$.each(e.properties,function(n,r){n=="font_size"?$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).css("font-size",r):n=="font_color"?$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).css("color",r):n=="font_style"?$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).css("font-style",r):n=="font_weight"?$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).css("font-weight",r):n=="bg_color"?$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).css("background-color",r):$(t.target).find(".canvas").find(".shapes").find("#stencil_"+e.timestamp).find("."+n).html(r)})}};