/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.window.manager=function(){this.window=null,this.tab=null,this.context_menu=null,this.list_menu=null,this.window_list_menu=null,this.workspace_container=null,this.window_list_container=null,this.index=0,this.window_tabview=null,this.active_window=-1,this.maximized=!1,this.window_list=null},org.goorm.core.window.manager.prototype={init:function(e){var t=this;this.window=[],this.tab=[],this.context_menu=[],this.window_list_menu=[],this.workspace_container=e,this.window_list=[],$("#"+e).append("<div id='"+e+"_window_list'><div class='tab_max_buttons' style='float:right;'><div class='unmaximize_all window_button'></div> <div class='maximized_close window_button'></div></div><div class='tab_scroll' style='float:right;'><div class='tab_list_left window_button'></div><div class='window_list window_button'></div><div class='tab_list_right window_button'></div></div></div>"),$(".unmaximize_all").click(function(e){return t.unmaximize_all(),e.preventDefault(),e.stopPropagation(),!1}),$(".tab_max_buttons").hide(),$(".maximized_close").click(function(){t.window[t.active_window].close()}),$(".tab_list_left").click(function(){t.active_window>0&&(t.active_window--,t.window[t.active_window].activate())}),$(".tab_list_right").click(function(){t.active_window<t.index-1&&(t.active_window++,t.window[t.active_window].activate())}),this.window_list_container=e+"_window_list",this.window_tabview=new YAHOO.widget.TabView(this.window_list_container),this.list_menu=new YAHOO.widget.Menu("window_list_menu"),this.list_menu.render(document.body),this.context_menu[0]=new org.goorm.core.menu.context,this.context_menu[0].init("configs/menu/org.goorm.core.window/window.manager.html","window.manager",e),this.context_menu[1]=new org.goorm.core.menu.context,this.context_menu[1].init("configs/menu/org.goorm.core.window/window.manager.tabview.html","window.manager.tabview",e+"_window_list"),$("#"+e).click(function(){t.context_menu[0].cancel(),t.context_menu[1].cancel();for(i=0;i<t.index;i++)t.window[i].context_menu&&t.window[i].context_menu.cancel(),t.tab[i].context_menu&&t.tab[i].context_menu.cancel()}),$("#"+e+"_window_list").find(".window_list").click(function(){return t.list_menu.show(),$("#window_list_menu").css("z-index",5),$("#window_list_menu").css("left",$("#"+e+"_window_list").find(".window_list").offset().left-$("#window_list_menu").width()+10),$("#window_list_menu").css("top",$("#"+e+"_window_list").find(".window_list").offset().top+10),!1}),$(core).bind("goorm_load_complete",function(){if(!$.isEmptyObject(localStorage.workspace_window)){var e=$.parseJSON(localStorage.workspace_window),n=0,r=0;$(e).each(function(e){t.open(this.filepath,this.filename,this.filetype,this.editor);var n=t.window[t.index-1];n.left=this.left,n.top=this.top,n.width=this.width,n.height=this.height,n.status=this.status,this.status=="maximized"?($("#"+n.container+"_c").offset({left:$("#"+n.workspace_container).offset().left-1,top:$("#"+t.workspace_container).offset().top}),$("#"+n.container+"_c").width($("#"+t.workspace_container).width()),$("#"+n.container+"_c").height($("#"+t.workspace_container).height()),$("#"+n.container).width($("#"+t.workspace_container).width()),$("#"+n.container).height($("#"+t.workspace_container).height()),$("#"+n.container).find(".ft").addClass("maximized_ft"),n.panel.cfg.setProperty("width",$("#"+t.workspace_container).width()+"px"),n.panel.cfg.setProperty("height",$("#"+t.workspace_container).height()+"px"),$(".tab_max_buttons").show(),n.resize.lock(),t.maximized=!0):($("#"+n.container+"_c").offset({left:this.left,top:this.top}),$("#"+n.container+"_c").width(this.width),$("#"+n.container+"_c").height(this.height),$("#"+n.container).width(this.width),$("#"+n.container).height(this.height),n.panel.cfg.setProperty("width",this.width+"px"),n.panel.cfg.setProperty("height",this.height-3+"px"),n.status=null,$(".tab_max_buttons").hide(),n.resize.unlock()),n.resize_all()})}}),$(core).bind("layout_resized",function(){t.maximized&&t.maximize_all()}),$(window).unload(function(){t.save_workspace()})},save_workspace:function(){console.log("save_workspace");var e=[],t=this;$(this.window).each(function(n){t.window[n].alive&&e.push({filepath:this.filepath,filename:this.filename,filetype:this.filetype,editor:this.type,left:this.left,top:this.top,width:this.width,height:this.height,index:this.index,status:this.status})}),localStorage.workspace_window=JSON.stringify(e)},open:function(e,t,n,r){var i=this.is_opened(e,t);return i>=0?(this.active_window=i,this.window[i].activate(),this.window[i]):(this.add(e,t,n,r),this.maximized&&this.window[this.window.length-1].maximize(),this.window[this.window.length-1])},find_by_filename:function(e,t){var n=null;return $(this.window).each(function(r){this.filepath==e&&this.filename==t&&(n=this)}),n},is_opened:function(e,t){var n=this,r=-1,i=[];return $(this.window).each(function(e){this.filepath==null&&this.filename==null&&i.push(e)}),$(i).each(function(e){n.window.pop(this)}),$(this.window).each(function(n){this.filepath==e&&this.filename==t&&(r=n)}),r},add:function(e,t,n,r){if(this.check_already_opened())m.s("warning","This file is already opened!!","window_manager");else{var i=this;this.active_window=this.index;var s=t;$("#"+this.workspace_container).append("<div id='filewindow"+this.index+"'></div>"),this.window[this.index]=new org.goorm.core.window.panel,this.window[this.index].init("filewindow"+this.index,s,this.workspace_container,e,t,n,r),this.tab[this.index]=new org.goorm.core.window.tab,this.tab[this.index].init("filewindow"+this.index,s,this.window_tabview,this.list_menu),this.window[this.index].connect(this.tab[this.index]),this.tab[this.index].connect(this.window[this.index]),this.active_window=this.index,this.window[this.index].index=this.index,this.window[this.index].activate(),this.tab[this.index].activate(),this.index++}},maximize_all:function(){$(this.window).each(function(e){this.maximize()}),this.maximized=!0},unmaximize_all:function(){$(this.window).each(function(e){this.unmaximize()}),this.maximized=!1},check_already_opened:function(e,t){},previous_window:function(){this.window[this.active_window-1]&&(this.window[this.active_window-1].activate(),this.active_window--,this.window[this.active_window].type=="Editor"&&this.window[this.active_window].editor.editor.focus())},next_window:function(){this.window[this.active_window+1]&&(this.window[this.active_window+1].activate(),this.active_window++,this.window[this.active_window].type=="Editor"&&this.window[this.active_window].editor.editor.focus())},hide_all_windows:function(){$(this.window).each(function(e){$("#"+this.container+"_c").hide("fast"),this.status="minimized"})},show_all_windows:function(){$(this.window).each(function(e){$("#"+this.container+"_c").show("fast"),this.status=null,this.resize_all()})},save_all:function(){for(var e=0;e<this.index;e++)if(this.window[e].alive){this.window[e].designer?this.window[e].designer.save():this.window[e].editor&&this.window[e].editor.save();var t=core.module.layout.workspace_window_manager;t.window[e].set_saved(),t.tab[e].set_saved()}},cascade:function(){var e=0,t=.6,n=.7;for(var r=0;r<this.index;r++)this.window[r].alive&&(this.window[r].status=="maximized"&&(this.window[r].maximize(),this.is_maxmizedd=!0),this.window[r].panel.left=4+24*e,this.window[r].panel.top=29+24*e,this.window[r].panel.width=$("#workspace").width()*t,this.window[r].panel.height=$("#workspace").height()*n,this.window[r].designer&&(m.s(this.window[r].type),$("#filewindow"+r+"_c").find(".canvas_container").css("width",this.window[r].panel.width-14+"px"),$("#filewindow"+r+"_c").find(".canvas_container").css("height",this.window[r].panel.height-68+"px"),$("#filewindow"+r+"_c").find(".ruler_x").css("width",this.window[r].panel.width-15+"px"),$("#filewindow"+r+"_c").find(".ruler_y").css("height",this.window[r].panel.height-65+"px")),$("#filewindow"+r+"_c").css("left",this.window[r].panel.left+"px"),$("#filewindow"+r+"_c").css("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").css("z-index",r),this.window[r].panel.cfg.setProperty("left",this.window[r].panel.left+"px"),this.window[r].panel.cfg.setProperty("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").css("height",this.window[r].panel.height+"px"),$("#filewindow"+r).children(".bd").height(this.window[r].panel.height-50),$("#filewindow"+r).css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").children(".window_container").height(this.window[r].panel.height-50),this.window[r].resize_all(),e++);this.is_maxmizedd=!1,$(".tab_max_buttons").hide()},tile_vertically:function(){var e=0,t=Math.floor(($("#workspace").width()-9)/this.count_alive_windows()),n=$("#workspace").height()-33;for(var r=0;r<this.index;r++)this.window[r].alive&&(this.window[r].status=="maximized"&&(this.window[r].maximize(),this.is_maxmizedd=!0),this.window[r].panel.left=4+t*e,this.window[r].panel.top=29,this.window[r].panel.width=t,this.window[r].panel.height=n,this.window[r].designer&&($("#filewindow"+r+"_c").find(".canvas_container").css("width",this.window[r].panel.width-14+"px"),$("#filewindow"+r+"_c").find(".canvas_container").css("height",this.window[r].panel.height-68+"px"),$("#filewindow"+r+"_c").find(".ruler_x").css("width",this.window[r].panel.width-15+"px"),$("#filewindow"+r+"_c").find(".ruler_y").css("height",this.window[r].panel.height-65+"px")),$("#filewindow"+r+"_c").css("left",this.window[r].panel.left+"px"),$("#filewindow"+r+"_c").css("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").css("height",this.window[r].panel.height+"px"),$("#filewindow"+r+"_c").css("z-index",r),this.window[r].panel.cfg.setProperty("left",this.window[r].panel.left+"px"),this.window[r].panel.cfg.setProperty("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").find(".yui-panel").css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").find(".yui-panel").css("height",this.window[r].panel.height+"px"),$("#filewindow"+r+"_c").children(".yui-panel").children(".bd").height(this.window[r].panel.height-50),$("#filewindow"+r+"_c").find(".window_container").find(".CodeMirror").height(this.window[r].panel.height-50),this.window[r].resize_all(),e++);this.is_maxmizedd=!1,$(".tab_max_buttons").hide()},tile_horizontally:function(){var e=0,t=$("#workspace").width()-9,n=Math.floor(($("#workspace").height()-33)/this.count_alive_windows());for(var r=0;r<this.index;r++)this.window[r].alive&&(this.window[r].status=="maximized"&&(this.window[r].maximize(),this.is_maxmizedd=!0),this.window[r].panel.left=4,this.window[r].panel.top=29+n*e,this.window[r].panel.width=t,this.window[r].panel.height=n,this.window[r].designer&&(m.s(this.window[r].type),$("#filewindow"+r+"_c").find(".canvas_container").css("width",this.window[r].panel.width-14+"px"),$("#filewindow"+r+"_c").find(".canvas_container").css("height",this.window[r].panel.height-68+"px"),$("#filewindow"+r+"_c").find(".ruler_x").css("width",this.window[r].panel.width-15+"px"),$("#filewindow"+r+"_c").find(".ruler_y").css("height",this.window[r].panel.height-65+"px")),$("#filewindow"+r+"_c").css("left",this.window[r].panel.left+"px"),$("#filewindow"+r+"_c").css("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").css("height",this.window[r].panel.height+"px"),$("#filewindow"+r+"_c").css("z-index",r),this.window[r].panel.cfg.setProperty("left",this.window[r].panel.left+"px"),this.window[r].panel.cfg.setProperty("top",this.window[r].panel.top+"px"),$("#filewindow"+r+"_c").find(".yui-panel").css("width",this.window[r].panel.width+"px"),$("#filewindow"+r+"_c").find(".yui-panel").css("height",this.window[r].panel.height+"px"),$("#filewindow"+r+"_c").children(".yui-panel").children(".bd").height(this.window[r].panel.height-50),$("#filewindow"+r+"_c").find(".window_container").find(".CodeMirror").height(this.window[r].panel.height-50),this.window[r].resize_all(),e++);this.is_maxmizedd=!1,$(".tab_max_buttons").hide()},count_alive_windows:function(){var e=0;for(var t=0;t<this.index;t++)this.window[t].alive&&e++;return e},close_all:function(){var e=this;$(this.window).each(function(e){this.is_saved=!0,this.tab.is_saved=!0,this.close()}),this.index=0,this.active_window=-1,this.window.remove(0,this.window.length-1)}};