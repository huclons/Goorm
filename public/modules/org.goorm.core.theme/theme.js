/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.theme=function(){this.theme_data=null,this.current_theme=null,this.current_theme_data=null,this.details_dialog=null,this.apply_theme_button=null,this.details_button=null},org.goorm.core.theme.prototype={init:function(){function t(t){e.apply_theme()}function n(t){e.details_dialog.show()}var e=this;e.apply_theme_button=new YAHOO.widget.Button({label:"Theme Apply",id:"theme_apply_button",container:"buttons_for_theme"}),e.details_button=new YAHOO.widget.Button({label:"Details",id:"details_button",container:"wrap_selectbox"}),e.apply_theme_button.on("click",t),e.details_button.on("click",n),$.get("theme/get_list","",function(t){e.theme_data=t,e.make_theme_selectbox()}),$("#theme_selectbox").change(function(){$(this).val()==-1?e.create_new_theme():(e.on_theme_selectbox_change($(this).val()),e.get_theme_contents($(this).val()))})},make_theme_selectbox:function(){var e=this;$("#theme_selectbox").empty();var t=parseInt($("#theme_selectbox").width()/8);for(var n=0;n<e.theme_data.length;n++){var r=e.theme_data[n].contents.title;r.length>t&&(r=r.substring(0,t-1),r+=" …");if(n==core.preference["preference.theme.current_theme"]){$("#theme_selectbox").append("<option value='"+n+"' selected>"+r+"</option>"),e.current_theme=e.theme_data[n],e.on_theme_selectbox_change(n);var i=$("link[kind='theme']");i.length==0?($("head").append("<link>"),i=$("head").children(":last"),i.attr({rel:"stylesheet",type:"text/css",href:"/configs/themes/"+e.current_theme.name+"/"+e.current_theme.name+".css",kind:"theme"})):i.attr({href:"/configs/themes/"+e.current_theme.name+"/"+e.current_theme.name+".css",kind:"theme"})}else $("#theme_selectbox").append("<option value='"+n+"'>"+r+"</option>")}e.details_dialog=new org.goorm.core.theme.details,e.details_dialog.init(e)},on_theme_selectbox_change:function(e){var t=this;t.current_theme=t.theme_data[e];var n=t.current_theme.contents.description,r=t.current_theme.contents.date,i=t.current_theme.contents.author,s=parseInt(($(".theme_info").width()-80)/8);n.length>s&&(n=n.substring(0,s-1),n+=" …"),i.length>s&&(i=i.substring(0,s-1),i+=" …"),$(".theme_info").empty(),$(".theme_info").append("<div>Description : "+n+"</div>"),$(".theme_info").append("<div>Version : "+r+"</div>"),$(".theme_info").append("<div>Author : "+i+"</div>"),t.current_theme.contents.modifiable=="true"?$("#"+t.details_button._configs.id.value).show():$("#"+t.details_button._configs.id.value).hide(),t.get_theme_contents(e)},get_theme_contents:function(e){var t=this,n="/public/configs/themes/"+t.current_theme.name+"/"+t.current_theme.name+".json";$.ajax({url:"theme/get_contents",type:"GET",data:{path:n},success:function(e){t.current_theme_data=JSON.parse(e)}})},apply_theme:function(){var e=this,t="theme/put_contents",n=e.current_theme.name+"/"+e.current_theme.name+".css",r="";for(var i in e.current_theme_data){r+=e.current_theme_data[i].selector+" {\n";for(var s in e.current_theme_data[i].style)if($.isArray(e.current_theme_data[i].style[s]))for(var o=0;o<e.current_theme_data[i].style[s].length;o++)r+="	"+s+":"+e.current_theme_data[i].style[s][o]+";\n";else r+="	"+s+":"+e.current_theme_data[i].style[s]+";\n";r+="}\n"}$.ajax({url:t,type:"GET",data:{path:n,data:r},success:function(t){var n=$("link[kind='theme']");n.length==0?($("head").append("<link>"),n=$("head").children(":last"),n.attr({rel:"stylesheet",type:"text/css",href:"/configs/themes/"+e.current_theme.name+"/"+e.current_theme.name+".css",kind:"theme"})):n.attr({href:"/configs/themes/"+e.current_theme.name+"/"+e.current_theme.name+".css",kind:"theme"}),m.s("Save complete! ("+e.filename+")","org.goorm.core.theme")}}),n=e.current_theme.name+"/"+e.current_theme.name+".json",r=JSON.stringify(e.current_theme_data,null,"	"),$.ajax({url:t,type:"GET",data:{path:n,data:r},success:function(t){m.s("Save complete! ("+e.filename+")","org.goorm.core.theme")}})},create_new_theme:function(){console.log("create new theme"),$(".theme_info").empty()}};