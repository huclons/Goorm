/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.dialog.explorer=function(){this.location_path=null,this.dir_tree=null,this.files=null,this.file_type=null,this.treeview=null,this.current_path=null,this.target_name=null,this.is_dir_only=!1},org.goorm.core.dialog.explorer.prototype={init:function(e,t){var n=this;n.location_path=e+"_location_path",n.dir_tree_ori=e+"_dir_tree",n.dir_tree_ori=n.dir_tree_ori.replace("#",""),n.dir_tree=e+"_dir_tree",n.files=e+"_files",n.current_path=core.status.current_project_path,$(n.location_path).val(n.current_path),n.target_name=e+"_target_name",$(n.target_name).val(""),n.is_dir_only=t,n.file_type=e+"_file_type",n.is_dir_only?n.add_directories():(n.add_directories(),n.add_file_items(),n.add_file_type_selector())},get_data:function(){var e=this,t={};return t.path=$(e.location_path).val(),t.path==""&&(t.path="/"),t.name=$(e.target_name).val(),t.type=$(e.file_type).val(),t.path.indexOf(" ")==-1&&t.name.indexOf(" ")==-1&&t.type.indexOf(" ")==-1?t:!1},add_directories:function(){var e=this;$(e.dir_tree).empty();var t={path:this.current_path};$.get("file/get_dir_nodes",t,function(t){e.treeview=new YAHOO.widget.TreeView(e.dir_tree_ori,t),e.treeview.subscribe("clickEvent",function(t){if(t.node.data.cls=="dir")return $(e.dir_tree+" td").removeClass("ygtvfocus"),$("#"+t.node.contentElId.replace("contentel","t")).addClass("ygtvfocus"),$("#"+t.node.contentElId).addClass("ygtvfocus"),e.current_path=(t.node.data.parent_label+t.node.data.name).replace("//","/"),$(e.location_path).attr("value",e.current_path),e.is_dir_only||e.add_file_items(),!1}),e.treeview.subscribe("dblClickEvent",function(e){e.node.data.cls=="dir"&&(e.node.expanded?e.node.collapse():e.node.expand())}),e.treeview.render(),e.tree_expand_complete(),e.treeview.subscribe("expandComplete",function(){e.tree_expand_complete()}),e.current_path==""&&($(e.dir_tree).find(".ygtvdepth0").find(".ygtvcell").prev().addClass("ygtvfocus"),$(e.dir_tree).find(".ygtvdepth0").find(".ygtvcell").addClass("ygtvfocus"))})},expand_directory:function(e){$(self.dir_tree).find(".ygtvfocus").parent().parent().parent().parent().find(".ygtvcell").each(function(){$(this).find(".fullpath").text().split("/").pop()==e&&($(self.dir_tree).find(".ygtvfocus").removeClass("ygtvfocus"),$(this).prev().addClass("ygtvfocus"),$(this).addClass("ygtvfocus"))}),this.treeview.getNodeByElement($(self.dir_tree).find(".ygtvfocus")[0]).expand()},tree_expand_complete:function(){$(self.dir_tree).find(".ygtvcell").unbind("mousedown"),$(self.dir_tree).find(".ygtvcell").mousedown(function(e){$(this).hasClass("ygtvfocus")==0&&($(self.dir_tree).find(".ygtvfocus").removeClass("ygtvfocus"),$(this).hasClass("ygtvcontent")&&($(this).prev().addClass("ygtvfocus"),$(this).addClass("ygtvfocus")))})},add_file_items:function(){var e=this;$(e.files).empty();var t={path:this.current_path};$.get("file/get_nodes",t,function(t){for(var n=0;n<t.length;n++){var r="";t[n].cls=="dir"?(r+="<div class='folder_item'",r+=" filename='"+t[n].name+"' filepath='"+t[n].parent_label+"'>",r+="<img src='images/org.goorm.core.file/folder.png'>"):(r+="<div class='file_item'",r+=" filename='"+t[n].filename+"' filetype='"+t[n].filetype+"' filepath='"+t[n].parent_label+"'>",r+="<img src='images/org.goorm.core.file/file.png'>"),r+="<div style='word-break:break-all; width:60px; line-height:12px; margin-left:5px; margin-right:5px; margin-bottom:5px;'>",t[n].cls=="dir"?r+=t[n].name:r+=t[n].filename,r+="</div>",r+="</div>",$(e.files).append(r)}$(e.files).find(".folder_item").dblclick(function(){e.current_path=="/"&&(e.current_path=""),e.current_path=e.current_path+"/"+$(this).attr("filename"),$(e.location_path).val(e.current_path),e.add_file_items(),e.expand_directory($(this).attr("filename"))}),$(e.files).find(".folder_item").click(function(){$(e.files).find(".file_item").removeClass("selected_item"),$(e.files).find(".folder_item").removeClass("selected_item"),$(this).addClass("selected_item")}),e.files=="#file_open_files"?($(e.files).find(".file_item").dblclick(function(){core.module.layout.workspace.window_manager.open($(this).attr("filepath"),$(this).attr("filename"),$(this).attr("filetype")),core.dialog.open_file.dialog.panel.hide()}),$(e.files).find(".file_item").click(function(){$(e.files).find(".file_item").removeClass("selected_item"),$(e.files).find(".folder_item").removeClass("selected_item"),$(this).addClass("selected_item"),$(e.target_name).attr("value",$(this).attr("filename")),e.filename=$(this).attr("filename"),e.filetype=$(this).attr("filetype"),e.filepath=$(this).attr("filepath")})):e.files=="#file_export_files"?$(e.files).find(".file_item").click(function(){$(e.files).find(".file_item").removeClass("selected_item"),$(e.files).find(".folder_item").removeClass("selected_item"),$(this).addClass("selected_item"),$(e.target_name).attr("value",$(this).attr("filename")),e.filename=$(this).attr("filename"),e.filetype=$(this).attr("filetype"),e.filepath=$(this).attr("filepath")}):$(e.files).find(".file_item").click(function(){$(e.files).find(".file_item").removeClass("selected_item"),$(e.files).find(".folder_item").removeClass("selected_item"),$(this).addClass("selected_item")})})},add_file_type_selector:function(){var e=this;$(e.file_type+" option:eq(0)").attr("selected","selected"),$(e.file_type).change(function(){$(e.files+" .file_item").show(),$(this).val()==""?$(e.files+" .file_item").show():$(e.files+" .file_item").each(function(){$(this).attr("filetype")!=$(e.file_type).val()&&$(this).hide()})})}};