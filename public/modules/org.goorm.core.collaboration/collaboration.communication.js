/**
 * Copyright Sung-tae Ryu. All rights reserved.
 * Code licensed under the GPL v2 License:
 * http://www.goorm.org/License
 **/org.goorm.core.collaboration.communication=function(){this.userID=0,this.userName=null,this.socket=null,this.predefined_colors=null,this.assigned_colors=null,this.updating_process_running=!1,this.update_queue=[],this.project_id=null,this.is_chat_on=null,this.timer=null,this.socket=null},org.goorm.core.collaboration.communication.prototype={init:function(e){var t=this;this.target=e,this.socket=io.connect(),$("#"+e).append("<div class='communication_user_container'>User </div>"),$("#"+e).append("<div class='communication_message_container'></div>"),$("#"+e).append("<div class='communication_message_input_container'><input id='input_chat_message' placeholder='Type your meessage...' style='width:90%;' /></div>"),$("#"+e+" #input_chat_message").keypress(function(e){if((e.keyCode||e.which)==13){e.preventDefault();var n=encodeURIComponent($(this).val());t.socket.socket.connected?t.socket.emit("message",'{"channel": "communication", "action":"send_message", "user":"'+core.user.first_name+"_"+core.user.last_name+'", "workspace": "'+core.status.current_project_name+'", "message":"'+n+'"}'):alert.show("Collaboration server is not opened!"),$(this).val("")}}),$(core).bind("layout_resized",function(){var e=$(".yui-layout-unit-right").find(".yui-layout-wrap").height()-25;$("#goorm_inner_layout_right").find(".communication_message_container").height(e-182)}),this.socket.on("communication_message",function(e){e=decodeURIComponent(e),$("#"+t.target).find(".communication_message_container").append("<div>"+e+"</div>"),$("#"+t.target).find(".communication_message_container").scrollTop(parseInt($("#"+t.target).find(".communication_message_container").height()))}),this.socket.on("communication_someone_joined",function(e){e=JSON.parse(e),$("#"+t.target).find(".communication_message_container").append("<div>"+e.user+" joined this workspace!</div>"),$("#"+t.target).find(".communication_user_container").html(e.list.join("<br />"))}),this.socket.on("communication_someone_leaved",function(e){e=JSON.parse(e),$("#"+t.target).find(".communication_message_container").append("<div>"+e.user+" leaved this workspace!</div>"),$("#"+t.target).find(".communication_user_container").html(e.list.join("<br />"))}),this.socket.on("disconnect",function(){t.leave()}),$(window).unload(function(){t.leave()})},clear:function(){$("#"+this.target).find(".communication_user_container").empty(),$("#"+this.target).find(".communication_message_container").empty()},join:function(){this.socket.emit("join",'{"channel": "workspace", "action":"join_workspace", "user":"'+core.user.first_name+"_"+core.user.last_name+'", "workspace":"'+core.status.current_project_name+'", "message":"hello"}')},leave:function(){this.socket.emit("leave",'{"channel": "workspace", "action":"leave_workspace", "user":"'+core.user.first_name+"_"+core.user.last_name+'", "workspace":"'+core.status.current_project_name+'", "message":"goodbye"}'),this.clear()},resize:function(){},set_chat_on:function(){},set_chat_off:function(){var e=this;return this.stop_listening(),this.is_chat_on=0,!1},get_clock_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),i="AM";t>11&&(i="PM"),t>12&&(t-=12),t==0&&(t=12),t<10&&(t="0"+t),n<10&&(n="0"+n),r<10&&(r="0"+r);var s=t+":"+n+":"+r+" "+i;return s}};